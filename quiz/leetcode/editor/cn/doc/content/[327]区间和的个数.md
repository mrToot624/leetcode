<p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„&nbsp;<code>nums</code> ä»¥åŠä¸¤ä¸ªæ•´æ•°&nbsp;<code>lower</code> å’Œ <code>upper</code> ã€‚æ±‚æ•°ç»„ä¸­ï¼Œå€¼ä½äºèŒƒå›´ <code>[lower, upper]</code> ï¼ˆåŒ…å«&nbsp;<code>lower</code>&nbsp;å’Œ&nbsp;<code>upper</code>ï¼‰ä¹‹å†…çš„ <strong>åŒºé—´å’Œçš„ä¸ªæ•°</strong> ã€‚</p>

<p><strong>åŒºé—´å’Œ</strong>&nbsp;<code>S(i, j)</code>&nbsp;è¡¨ç¤ºåœ¨&nbsp;<code>nums</code>&nbsp;ä¸­ï¼Œä½ç½®ä»&nbsp;<code>i</code>&nbsp;åˆ°&nbsp;<code>j</code>&nbsp;çš„å…ƒç´ ä¹‹å’Œï¼ŒåŒ…å«&nbsp;<code>i</code>&nbsp;å’Œ&nbsp;<code>j</code>&nbsp;(<code>i</code> â‰¤ <code>j</code>)ã€‚</p>

<p>&nbsp;</p> 
<strong>ç¤ºä¾‹ 1ï¼š</strong>

<pre>
<strong>è¾“å…¥ï¼š</strong>nums = [-2,5,-1], lower = -2, upper = 2
<strong>è¾“å‡ºï¼š</strong>3
<strong>è§£é‡Šï¼š</strong>å­˜åœ¨ä¸‰ä¸ªåŒºé—´ï¼š[0,0]ã€[2,2] å’Œ [0,2] ï¼Œå¯¹åº”çš„åŒºé—´å’Œåˆ†åˆ«æ˜¯ï¼š-2 ã€-1 ã€2 ã€‚
</pre>

<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>nums = [0], lower = 0, upper = 0
<strong>è¾“å‡ºï¼š</strong>1
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul> 
 <li><code>1 &lt;= nums.length &lt;= 10<sup>5</sup></code></li> 
 <li><code>-2<sup>31</sup> &lt;= nums[i] &lt;= 2<sup>31</sup> - 1</code></li> 
 <li><code>-10<sup>5</sup> &lt;= lower &lt;= upper &lt;= 10<sup>5</sup></code></li> 
 <li>é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆæ˜¯ä¸€ä¸ª <strong>32 ä½</strong> çš„æ•´æ•°</li> 
</ul>

<details><summary><strong>Related Topics</strong></summary>æ ‘çŠ¶æ•°ç»„ | çº¿æ®µæ ‘ | æ•°ç»„ | äºŒåˆ†æŸ¥æ‰¾ | åˆ†æ²» | æœ‰åºé›†åˆ | å½’å¹¶æ’åº</details><br>

<div>ğŸ‘ 586, ğŸ‘ 0<span style='float: right;'><span style='color: gray;'><a href='https://github.com/labuladong/fucking-algorithm/discussions/939' target='_blank' style='color: lightgray;text-decoration: underline;'>bug åé¦ˆ</a> | <a href='https://labuladong.online/algo/fname.html?fname=jbæ’ä»¶ç®€ä»‹' target='_blank' style='color: lightgray;text-decoration: underline;'>ä½¿ç”¨æŒ‡å—</a> | <a href='https://labuladong.online/algo/images/others/%E5%85%A8%E5%AE%B6%E6%A1%B6.jpg' target='_blank' style='color: lightgray;text-decoration: underline;'>æ›´å¤šé…å¥—æ’ä»¶</a></span></span></div>

<div id="labuladong"><hr>

**é€šçŸ¥ï¼š[æ–°ç‰ˆç½‘ç«™ä¼šå‘˜](https://labuladong.online/algo/intro/site-vip/) å³å°†æ¶¨ä»·ï¼ç®—æ³•å¯è§†åŒ–ç¼–è¾‘å™¨ä¸Šçº¿ï¼Œ[ç‚¹å‡»ä½“éªŒ](https://labuladong.online/algo/intro/visualize/)ï¼**



<p><strong><a href="https://labuladong.online/algo/slug.html?slug=count-of-range-sum" target="_blank">â­ï¸labuladong é¢˜è§£</a></strong></p>
<details><summary><strong>labuladong æ€è·¯</strong></summary>

## åŸºæœ¬æ€è·¯

è¿™é“é¢˜éš¾åº¦éå¸¸å¤§ï¼Œå»ºè®®ä½ å…ˆé˜…è¯»å‰æ–‡ [å°è€Œç¾çš„ç®—æ³•æŠ€å·§ï¼šå‰ç¼€å’Œæ•°ç»„](https://labuladong.online/algo/data-structure/prefix-sum/) ä»¥åŠ [å½’å¹¶æ’åºè¯¦è§£åŠåº”ç”¨](https://labuladong.online/algo/practice-in-action/merge-sort/)ï¼Œå¹¶å®Œæˆ [315. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°ï¼ˆå›°éš¾ï¼‰](/problems/count-of-smaller-numbers-after-self/)ã€‚

ç„¶åï¼Œä½ å°±ä¼šå‘ç°ï¼Œè¿™é“é¢˜å’Œ [315. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°ï¼ˆå›°éš¾ï¼‰](/problems/count-of-smaller-numbers-after-self/) éå¸¸ç±»ä¼¼ï¼š

315 é¢˜è®©ä½ è®¡ç®—æ¯ä¸ªå…ƒç´ ä¹‹åæ¯”å®ƒå°çš„å…ƒç´ ä¸ªæ•°ï¼Œå³æ±‚å‡ºä¸€ä¸ª `count` æ•°ç»„ï¼Œä½¿å¾— `count[i] = COUNT(nums[j], j > i and nums[j] < nums[i])`ã€‚

è¿™é“é¢˜ï¼Œä½ å¯ä»¥å…ˆå¯¹åŸæ•°ç»„æ±‚ä¸€ä¸‹å‰ç¼€å’Œæ•°ç»„ `preSum`ï¼Œç„¶åå» `preSum` ä¸­æ±‚ä¸€ä¸ª `count` æ•°ç»„ï¼Œä½¿å¾— `count[i] = COUNT(nums[j], j > i and lower <= preSum[j] - nums[i] <= upper)`ï¼Œç„¶å `SUM(count)` å°±æ˜¯é¢˜ç›®æƒ³è¦çš„ç»“æœã€‚

é‚£ä¹ˆæ€è·¯ä¹Ÿæ˜¯åœ¨å½’å¹¶æ’åºçš„è¿‡ç¨‹ä¸­å¤¹å¸¦ç‚¹ç§è´§ï¼Œå¯ä»¥å¯¹æ¯”ç¬¬ 315 é¢˜ç›´æ¥çœ‹è§£æ³•ä»£ç ã€‚

**è¯¦ç»†é¢˜è§£ï¼š[å½’å¹¶æ’åºè¯¦è§£åŠåº”ç”¨](https://labuladong.online/algo/practice-in-action/merge-sort/)**

**æ ‡ç­¾ï¼šå‰ç¼€å’Œï¼Œ[åŒæŒ‡é’ˆ](https://labuladong.online/algo/)ï¼Œå½’å¹¶æ’åº**

## è§£æ³•ä»£ç 

æç¤ºï¼šğŸŸ¢ æ ‡è®°çš„æ˜¯æˆ‘å†™çš„è§£æ³•ä»£ç ï¼ŒğŸ¤– æ ‡è®°çš„æ˜¯ chatGPT ç¿»è¯‘çš„å¤šè¯­è¨€è§£æ³•ä»£ç ã€‚å¦‚æœ‰é”™è¯¯ï¼Œå¯ä»¥ [ç‚¹è¿™é‡Œ](https://github.com/labuladong/fucking-algorithm/issues/1113) åé¦ˆå’Œä¿®æ­£ã€‚

<div class="tab-panel"><div class="tab-nav">
<button data-tab-item="cpp" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">cppğŸ¤–</button>

<button data-tab-item="python" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">pythonğŸ¤–</button>

<button data-tab-item="java" class="tab-nav-button btn active" data-tab-group="default" onclick="switchTab(this)">javağŸŸ¢</button>

<button data-tab-item="go" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">goğŸ¤–</button>

<button data-tab-item="javascript" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">javascriptğŸ¤–</button>
</div><div class="tab-content">
<div data-tab-item="cpp" class="tab-item " data-tab-group="default"><div class="highlight">

```cpp
// æ³¨æ„ï¼šcpp ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
// æœ¬ä»£ç å·²ç»é€šè¿‡åŠ›æ‰£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåº”è¯¥å¯ç›´æ¥æˆåŠŸæäº¤ã€‚

class Solution {
private:
    int lower, upper;
    int count = 0;
    vector<long long> temp;
public:
    int countRangeSum(vector<int>& nums, int lower, int upper) {
        this->lower = lower;
        this->upper = upper;
        vector<long long> preSum(nums.size() + 1);
        for (int i = 0; i < nums.size(); i++) {
            preSum[i + 1] = nums[i] + preSum[i];
        }
        sort(preSum, 0, preSum.size()- 1);
        return count;
    }

    // å½’å¹¶æ’åº
    void sort(vector<long long>& nums, int lo, int hi) {
        if (lo == hi) {
            // å•ä¸ªå…ƒç´ ä¸ç”¨æ’åº
            return;
        }
        int mid = lo + (hi - lo) / 2;
        // å…ˆå¯¹å·¦åŠéƒ¨åˆ†æ•°ç»„ nums[lo..mid] æ’åº
        sort(nums, lo, mid);
        // å†å¯¹å³åŠéƒ¨åˆ†æ•°ç»„ nums[mid+1..hi] æ’åº
        sort(nums, mid + 1, hi);
        // å°†ä¸¤éƒ¨åˆ†æœ‰åºæ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„
        merge(nums, lo, mid, hi);
    }

    // å½’å¹¶æ“ä½œ
    void merge(vector<long long>& nums, int lo, int mid, int hi) {
        temp.assign(mid - lo + 1 + hi - mid, 0);
        int i = lo, j = mid + 1, k = 0, start = mid + 1, end = mid + 1;
        while (i <= mid) {
            while (start <= hi && nums[start] - nums[i] < lower) {
                start++;
            }
            while (end <= hi && nums[end] - nums[i] <= upper) {
                end++;
            }
            count += end - start;
            while (j <= hi && nums[j] < nums[i]) {
                temp[k++] = nums[j++];
            }
            temp[k++] = nums[i++];
        }
        while (j <= hi) {
            temp[k++] = nums[j++];
        }
        for (int p = 0; p < k; p++) {
            nums[lo + p] = temp[p];
        }
    }
};
```

</div></div>

<div data-tab-item="python" class="tab-item " data-tab-group="default"><div class="highlight">

```python
# æ³¨æ„ï¼špython ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
# æœ¬ä»£ç å·²ç»é€šè¿‡åŠ›æ‰£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåº”è¯¥å¯ç›´æ¥æˆåŠŸæäº¤ã€‚

class Solution:
    def __init__(self):
        self.lower, self.upper = 0, 0

    def countRangeSum(self, nums: List[int], lower: int, upper: int) -> int:
        # å®šä¹‰å…¨å±€å˜é‡
        self.lower, self.upper = lower, upper
        # å‰ç¼€å’Œæ•°ç»„
        preSum = [0] * (len(nums) + 1)
        for i in range(len(nums)):
            preSum[i + 1] = nums[i] + preSum[i]
        # æ’åº
        self.sort(preSum)
        return self.count

    def sort(self, nums):
        # å®šä¹‰è¾…åŠ©åˆå¹¶æ•°ç»„
        self.temp = [0] * len(nums)
        # å®šä¹‰è®¡æ•°å™¨
        self.count = 0
        # è°ƒç”¨é€’å½’æ’åºæ–¹æ³•
        self._sort(nums, 0, len(nums) - 1)

    def _sort(self, nums, lo, hi):
        # æ’åºå­æ•°ç»„nums[lo..hi]
        if lo == hi:
            return
        mid = lo + (hi - lo) // 2
        self._sort(nums, lo, mid)
        self._sort(nums, mid + 1, hi)
        self._merge(nums, lo, mid, hi)

    def _merge(self, nums, lo, mid, hi):
        # åˆå¹¶ä¸¤ä¸ªæœ‰åºå­æ•°ç»„ nums[lo..mid] å’Œ nums[mid+1..hi]
        
        # å…ˆå°† nums[lo..hi] å¤åˆ¶åˆ°ä¸´æ—¶æ•°ç»„ temp ä¸­
        for i in range(lo, hi + 1):
            self.temp[i] = nums[i]

        # å·¦å³ä¸¤éƒ¨åˆ†è®¡æ•°å™¨ start å’Œ end
        start, end = mid + 1, mid + 1
        for i in range(lo, mid + 1):
            while start <= hi and nums[start] - nums[i] < self.lower:
                start += 1
            while end <= hi and nums[end] - nums[i] <= self.upper:
                end += 1
            # æ›´æ–°è®¡æ•°å™¨
            self.count += end - start

        # æ•°ç»„åˆå¹¶ï¼ŒåŒæŒ‡é’ˆæŠ€å·§
        i, j = lo, mid + 1
        for p in range(lo, hi + 1):
            if i > mid:
                nums[p] = self.temp[j]
                j += 1
            elif j > hi:
                nums[p] = self.temp[i]
                i += 1
            elif self.temp[i] < self.temp[j]:
                nums[p] = self.temp[i]
                i += 1
            else:
                nums[p] = self.temp[j]
                j += 1
```

</div></div>

<div data-tab-item="java" class="tab-item active" data-tab-group="default"><div class="highlight">

```java
class Solution {
    int lower, upper;

    public int countRangeSum(int[] nums, int lower, int upper) {
        this.lower = lower;
        this.upper = upper;
        long[] preSum = new long[nums.length + 1];
        for (int i = 0; i < nums.length; i++) {
            preSum[i + 1] = (long) nums[i] + preSum[i];
        }
        sort(preSum);
        return count;
    }

    // ç”¨äºè¾…åŠ©åˆå¹¶æœ‰åºæ•°ç»„
    private long[] temp;
    private int count = 0;

    public void sort(long[] nums) {
        // å…ˆç»™è¾…åŠ©æ•°ç»„å¼€è¾Ÿå†…å­˜ç©ºé—´
        temp = new long[nums.length];
        // æ’åºæ•´ä¸ªæ•°ç»„ï¼ˆåŸåœ°ä¿®æ”¹ï¼‰
        sort(nums, 0, nums.length - 1);
    }

    // å®šä¹‰ï¼šå°†å­æ•°ç»„ nums[lo..hi] è¿›è¡Œæ’åº
    private void sort(long[] nums, int lo, int hi) {
        if (lo == hi) {
            // å•ä¸ªå…ƒç´ ä¸ç”¨æ’åº
            return;
        }
        // è¿™æ ·å†™æ˜¯ä¸ºäº†é˜²æ­¢æº¢å‡ºï¼Œæ•ˆæœç­‰åŒäº (hi + lo) / 2
        int mid = lo + (hi - lo) / 2;
        // å…ˆå¯¹å·¦åŠéƒ¨åˆ†æ•°ç»„ nums[lo..mid] æ’åº
        sort(nums, lo, mid);
        // å†å¯¹å³åŠéƒ¨åˆ†æ•°ç»„ nums[mid+1..hi] æ’åº
        sort(nums, mid + 1, hi);
        // å°†ä¸¤éƒ¨åˆ†æœ‰åºæ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„
        merge(nums, lo, mid, hi);
    }

    // å°† nums[lo..mid] å’Œ nums[mid+1..hi] è¿™ä¸¤ä¸ªæœ‰åºæ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„
    private void merge(long[] nums, int lo, int mid, int hi) {
        // å…ˆæŠŠ nums[lo..hi] å¤åˆ¶åˆ°è¾…åŠ©æ•°ç»„ä¸­
        // ä»¥ä¾¿åˆå¹¶åçš„ç»“æœèƒ½å¤Ÿç›´æ¥å­˜å…¥ nums
        for (int i = lo; i <= hi; i++) {
            temp[i] = nums[i];
        }

        // è¿™æ®µä»£ç ä¼šè¶…æ—¶
        // for (int i = lo; i <= mid; i++) {
        // // åœ¨åŒºé—´ [mid + 1, hi] ä¸­å¯»æ‰¾ lower <= delta <= upper çš„å…ƒç´ 
        //     for (int k = mid + 1; k <= hi; k++) {
        //         long delta = nums[k] - nums[i];
        //         if (delta <= upper && delta >= lower) {
        //             count++;
        //         }
        //     }
        // }

        // è¿›è¡Œæ•ˆç‡ä¼˜åŒ–
        // ç»´æŠ¤å·¦é—­å³å¼€åŒºé—´ [start, end) ä¸­çš„å…ƒç´ è½åœ¨ [lower, upper] ä¸­
        int start = mid + 1, end = mid + 1;
        for (int i = lo; i <= mid; i++) {
            while (start <= hi && nums[start] - nums[i] < lower) {
                start++;
            }
            while (end <= hi && nums[end] - nums[i] <= upper) {
                end++;
            }
            count += end - start;
        }

        // æ•°ç»„åŒæŒ‡é’ˆæŠ€å·§ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
        int i = lo, j = mid + 1;
        for (int p = lo; p <= hi; p++) {
            if (i == mid + 1) {
                // å·¦åŠè¾¹æ•°ç»„å·²å…¨éƒ¨è¢«åˆå¹¶
                nums[p] = temp[j++];
            } else if (j == hi + 1) {
                // å³åŠè¾¹æ•°ç»„å·²å…¨éƒ¨è¢«åˆå¹¶
                nums[p] = temp[i++];
            } else if (temp[i] > temp[j]) {
                nums[p] = temp[j++];
            } else {
                nums[p] = temp[i++];
            }
        }
    }
}
```

</div></div>

<div data-tab-item="go" class="tab-item " data-tab-group="default"><div class="highlight">

```go
// æ³¨æ„ï¼šgo ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
// æœ¬ä»£ç å·²ç»é€šè¿‡åŠ›æ‰£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåº”è¯¥å¯ç›´æ¥æˆåŠŸæäº¤ã€‚

func countRangeSum(nums []int, lower int, upper int) int {
    preSum := make([]int64, len(nums)+1)
    for i := 0; i < len(nums); i++ {
        preSum[i+1] = int64(nums[i]) + preSum[i]
    }
    return sortAndCount(preSum, lower, upper)
}

// ç”¨äºè¾…åŠ©åˆå¹¶æœ‰åºæ•°ç»„
func sortAndCount(nums []int64, lower int, upper int) int {
    // å…ˆç»™è¾…åŠ©æ•°ç»„å¼€è¾Ÿå†…å­˜ç©ºé—´
    temp := make([]int64, len(nums))
    // æ’åºæ•´ä¸ªæ•°ç»„ï¼ˆåŸåœ°ä¿®æ”¹ï¼‰
    return sort(nums, temp, 0, len(nums)-1, lower, upper)
}

// å®šä¹‰ï¼šå°†å­æ•°ç»„ nums[lo..hi] è¿›è¡Œæ’åº
func sort(nums, temp []int64, lo, hi, lower, upper int) int {
    if lo == hi {
        // å•ä¸ªå…ƒç´ ä¸ç”¨æ’åº
        return 0
    }
    // è¿™æ ·å†™æ˜¯ä¸ºäº†é˜²æ­¢æº¢å‡ºï¼Œæ•ˆæœç­‰åŒäº (hi + lo) / 2
    mid := lo + (hi-lo)/2
    // å…ˆå¯¹å·¦åŠéƒ¨åˆ†æ•°ç»„ nums[lo..mid] æ’åº
    count := sort(nums, temp, lo, mid, lower, upper)
    // å†å¯¹å³åŠéƒ¨åˆ†æ•°ç»„ nums[mid+1..hi] æ’åº
    count += sort(nums, temp, mid+1, hi, lower, upper)
    // å°†ä¸¤éƒ¨åˆ†æœ‰åºæ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„
    count += merge(nums, temp, lo, mid, hi, lower, upper)
    return count
}

// å°† nums[lo..mid] å’Œ nums[mid+1..hi] è¿™ä¸¤ä¸ªæœ‰åºæ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„
func merge(nums, temp []int64, lo, mid, hi, lower, upper int) int {
    // å…ˆæŠŠ nums[lo..hi] å¤åˆ¶åˆ°è¾…åŠ©æ•°ç»„ä¸­
    // ä»¥ä¾¿åˆå¹¶åçš„ç»“æœèƒ½å¤Ÿç›´æ¥å­˜å…¥ nums
    for i := lo; i <= hi; i++ {
        temp[i] = nums[i]
    }

    // è¿™æ®µä»£ç ä¼šè¶…æ—¶
    // for (int i = lo; i <= mid; i++) {
    // // åœ¨åŒºé—´ [mid + 1, hi] ä¸­å¯»æ‰¾ lower <= delta <= upper çš„å…ƒç´ 
    //     for (int k = mid + 1; k <= hi; k++) {
    //         long delta = nums[k] - nums[i];
    //         if (delta <= upper && delta >= lower) {
    //             count++;
    //         }
    //     }
    // }

    // è¿›è¡Œæ•ˆç‡ä¼˜åŒ–
    // ç»´æŠ¤å·¦é—­å³å¼€åŒºé—´ [start, end) ä¸­çš„å…ƒç´ è½åœ¨ [lower, upper] ä¸­
    start, end := mid+1, mid+1
    count := 0
    for i := lo; i <= mid; i++ {
        for start <= hi && temp[start]-temp[i] < int64(lower) {
            start++
        }
        for end <= hi && temp[end]-temp[i] <= int64(upper) {
            end++
        }
        count += end - start
    }

    // æ•°ç»„åŒæŒ‡é’ˆæŠ€å·§ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
    i, j := lo, mid+1
    for p := lo; p <= hi; p++ {
        if i == mid+1 {
            // å·¦åŠè¾¹æ•°ç»„å·²å…¨éƒ¨è¢«åˆå¹¶
            nums[p] = temp[j]
            j++
        } else if j == hi+1 {
            // å³åŠè¾¹æ•°ç»„å·²å…¨éƒ¨è¢«åˆå¹¶
            nums[p] = temp[i]
            i++
        } else if temp[i] > temp[j] {
            nums[p] = temp[j]
            j++
        } else {
            nums[p] = temp[i]
            i++
        }
    }
    return count
}
```

</div></div>

<div data-tab-item="javascript" class="tab-item " data-tab-group="default"><div class="highlight">

```javascript
// æ³¨æ„ï¼šjavascript ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
// æœ¬ä»£ç å·²ç»é€šè¿‡åŠ›æ‰£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåº”è¯¥å¯ç›´æ¥æˆåŠŸæäº¤ã€‚

var countRangeSum = function(nums, lower, upper) {
    let count = 0;
    const n = nums.length;
    const preSum = new Array(n + 1).fill(0);
    for (let i = 0; i < n; i++) {
        preSum[i + 1] = nums[i] + preSum[i];
    }

    mergeSort(preSum, 0, n);

    return count;

    function mergeSort(nums, left, right) {
        if (left >= right) {
            return;
        }
        const mid = left + Math.floor((right - left) / 2);
        mergeSort(nums, left, mid);
        mergeSort(nums, mid + 1, right);

        let i = left;
        let j = mid + 1;
        let k = 0;
        let t = 0;
        const temp = new Array(right - left + 1);

        while (i <= mid && j <= right) {
            if (nums[i] <= nums[j]) {
                // ç»Ÿè®¡åŒºé—´å’Œ count
                while (t <= right && nums[t] - nums[i] < lower) {
                    t++;
                }
                while (k <= right && nums[k] - nums[i] <= upper) {
                    k++;
                }
                count += k - t;
                temp[i - left] = nums[i++];
            } else {
                temp[i - left] = nums[j++];
            }
        }
        while (i <= mid) {
            temp[i - left] = nums[i++];
        }
        while (j <= right) {
            temp[i - left] = nums[j++];
        }
        for (let p = left; p <= right; p++) {
            nums[p] = temp[p - left];
        }
    }
};
```

</div></div>
</div></div>

<hr /><details open hint-container details><summary style="font-size: medium"><strong>ğŸƒğŸƒ ç®—æ³•å¯è§†åŒ– ğŸƒğŸƒ</strong></summary><div id="data_count-of-range-sum" data="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"></div><div class="resizable aspect-ratio-container" style="height: 100%;">
<div id="iframe_count-of-range-sum"></div></div>
</details><hr /><br />

**ç±»ä¼¼é¢˜ç›®**ï¼š
  - [315. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•° ğŸ”´](/problems/count-of-smaller-numbers-after-self)
  - [493. ç¿»è½¬å¯¹ ğŸ”´](/problems/reverse-pairs)
  - [912. æ’åºæ•°ç»„ ğŸŸ ](/problems/sort-an-array)

</details>
</div>

